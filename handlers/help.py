import logging

from aiogram.types import CallbackQuery
from aiogram import Router
from utils.db import connect, close
from keyboards.inline import help_keyboard, question_answer_keyboard, meal_question_keyboard, back_or_main_menu_keyboard, training_question_keyboard, pay_problem_keyboard
router = Router()


@router.callback_query(lambda c: c.data == "help")
async def send_help(callback: CallbackQuery):
    await callback.message.answer(text=f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–¥–µ–ª <b>–ü–û–ú–û–©–ò</b>\n"
                                       f"üëâ–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µüëà", reply_markup=help_keyboard, parse_mode="HTML")
    await callback.answer()


@router.callback_query(lambda c: c.data == "qwestion/answer")
async def send_answer(callback: CallbackQuery):
    await callback.message.answer(text=f"–í—ã–±–µ—Ä–µ—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –ø–æ –∫–æ—Ç–æ—Ä–æ–π —É –≤–∞—Å –ø–æ—è–≤–∏–ª—Å—è –≤–æ–ø—Ä–æ—Å:", reply_markup=question_answer_keyboard)
    await callback.answer()

@router.callback_query(lambda c: c.data == "meal_question")
async def send_answer_meal(callback: CallbackQuery):
    await callback.message.answer(text=f"‚ÄºÔ∏è–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã:‚ÄºÔ∏è\n"
                                        f"‚ùì –í–∫–ª—é—á–µ–Ω–æ –ª–∏ –ø–∏—Ç–∞–Ω–∏–µ? üçèüçõ\n"
                                        f"–í –º–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –ø–æ–Ω–µ–¥–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è.\n"
                                        f"1 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é, –≤ —Å—É–±–±–æ—Ç—É –≤ 12.00 –ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏, –≤–∞–º –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –Ω–æ–≤—ã–π —Ä–∞—Ü–∏–æ–Ω, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–∏—Ç–∞—Ç—å—Å—è —Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞ –ø–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ.\n"
                                        f"‚ùì –ó–∞ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –¥–æ –∏ —á–µ—Ä–µ–∑ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –º–æ–∂–Ω–æ –µ—Å—Ç—å? üèãÔ∏è‚Äç‚ôÇÔ∏èüçåü•§\n"
                                        f"–ü—Ä–∏–º—ë–º –ø–∏—â–∏ –¥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–ª–æ—Ç–Ω—ã–π –∑–∞ 1,5-2 —á–∞—Å–∞, –ª—ë–≥–∫–∏–π –ø–µ—Ä–µ–∫—É—Å –∑–∞ —á–∞—Å, –∑–∞ –ø–æ–ª—á–∞—Å–∞ –º–æ–∂–Ω–æ —Å—ä–µ—Å—Ç—å –ø–∞—Ä—É —Ñ—Ä—É–∫—Ç–æ–≤ –∏–ª–∏ –≤—ã–ø–∏—Ç—å —Å–≤–µ–∂–µ–≤—ã–∂–∞—Ç—ã–π —Ñ—Ä–µ—à. –ü–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –µ—Å—Ç—å –æ–≤–æ—â–∏ –∏ –±–µ–ª–æ–∫ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞, –º–∞–∫—Å–∏–º—É–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫—Ä—É–ø—É.\n"
                                        f"‚ùì –ö–∞–∫ –∏ –∫–æ–≥–¥–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–µ–µ –≤–∑–≤–µ—à–∏–≤–∞—Ç—å—Å—è? ‚öñÔ∏è\n"
                                        f"–í–∑–≤–µ—à–∏–≤–∞—Ç—å—Å—è –ª–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å? üìÜ\n"
                                        f"–í–∑–≤–µ—à–∏–≤–∞–π—Ç–µ—Å—å —É—Ç—Ä–æ–º –ø–æ—Å–ª–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è –∏ —Ç—É–∞–ª–µ—Ç–∞ –≥–æ–ª—ã–º–∏ –∏ –Ω–∞ –≥–æ–ª–æ–¥–Ω—ã–π –∂–µ–ª—É–¥–æ–∫. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≤–∑–≤–µ—à–∏–≤–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —á—Ç–æ–±—ã –Ω–µ —É–ø—É—Å—Ç–∏—Ç—å –º–æ–º–µ–Ω—Ç–∞, –∫–æ–≥–¥–∞ –≤—ã –Ω–∞—á–Ω—ë—Ç–µ –ø–æ–ø—Ä–∞–≤–ª—è—Ç—å—Å—è. –¢–∞–∫ –Ω–µ–∑–∞–º–µ—Ç–Ω–æ –º–æ–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å –∏ 5 –∫–≥.\n"
                                        f"‚ùì –°–∫–æ–ª—å–∫–æ –∫–≥ —Ä–µ–∞–ª—å–Ω–æ —Å–∫–∏–Ω—É—Ç—å –∑–∞ 4 –Ω–µ–¥–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞? üìâ\n"
                                        f"–ü—Ä–∏ –ø–æ–ª–Ω–æ–º —Å–æ–±–ª—é–¥–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π: 2-4 –∫–≥. –ë–æ–ª—å—à–µ –∏ –Ω–µ –Ω—É–∂–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —è –ø—Ä–æ—Ç–∏–≤ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ—Ö—É–¥–µ–Ω–∏—è, –æ—Ä–≥–∞–Ω–∏–∑–º –¥–æ–ª–∂–µ–Ω —É—Å–ø–µ–≤–∞—Ç—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è.\n",
                                        reply_markup=meal_question_keyboard)
    await callback.answer()

    @router.callback_query(lambda c: c.data == "recomendation")
    async def send_recomendation_meal(callback: CallbackQuery):
        await callback.message.answer(text=f"ü•¶–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–∏—Ç–∞–Ω–∏—éü•¶\n"
                                           f" ‚ùì –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –æ—á–µ–Ω—å —Ö–æ—á–µ—Ç—Å—è –µ—Å—Ç—å, –∞ –≤—Å–µ –ø—Ä–∏–µ–º—ã –ø–∏—â–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å? –ò–ª–∏ –ø–æ—à—ë–ª –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω/–Ω–∞ –¥—Ä?\n"
                                           f" –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–∏–µ–º—ã –ø–∏—â–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å, —Ç–æ –º–æ–∂–Ω–æ –ø–æ–µ—Å—Ç—å –æ–≤–æ—â–∏ –∏ —Ä—ã–±—É (–±–µ–∑ —Å–æ–ª–∏ –∏ —Å–æ—É—Å–æ–≤, –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ –ø–∞—Ä—É –∏–ª–∏ –Ω–∞ –≥—Ä–∏–ª–µ)\n"
                                           f" ‚ùì –ù–∞–¥–æ –ª–∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤–∏—Ç–∞–º–∏–Ω—ã –∏ –∫–∞–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç–µ?\n"
                                           f" –†–µ–∫–æ–º–µ–Ω–¥—É—é —Å–¥–∞—Ç—å –∞–Ω–∞–ª–∏–∑—ã, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —á–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤–∞—à–µ–º—É –æ—Ä–≥–∞–Ω–∏–∑–º—É –∏–ª–∏ –ø–∏—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –≤–∏—Ç–∞–º–∏–Ω—ã.\n"
                                           f" ‚ùì –°–∫–æ–ª—å–∫–æ —è–∏—Ü –º–æ–∂–Ω–æ –µ—Å—Ç—å –≤ –¥–µ–Ω—å?\n"
                                           f" –Ø–π—Ü –º–æ–∂–Ω–æ –µ—Å—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª-–≤–æ, –≥–ª–∞–≤–Ω–æ–µ –∂–µ–ª—Ç–∫–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–µ–π –º–∞—Å—Å—ã —Ç–µ–ª–µ –µ—Å—Ç—ä –Ω–µ –±–æ–ª–µ–µ 3-6 —à—Ç—É–∫ –≤ –¥–µ–Ω—å.\n"
                                           f" ‚ùì –ï—Å–ª–∏ –ø–æ–¥–æ—à–ª–æ –≤—Ä–µ–º—è —É–∂–∏–Ω–∞ (4-5 —á–∞—Å–æ–≤ –¥–æ —Å–Ω–∞), –∞ —è –Ω–µ —Ö–æ—á—É –µ—Å—Ç—å. –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å?\n"
                                           f" –ü—Ä–∏–µ–º—ã –ø–∏—â–∏ –Ω–µ–ª—å–∑—è –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å. –ü–∏—Ç–∞–Ω–∏–µ - —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ –∏ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–º–∞.\n"
                                           f" ‚ùì –ó–∞ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –¥–æ —Å–Ω–∞ –Ω–∞–¥–æ –ø—Ä–µ–∫—Ä–∞—â–∞—Ç—å –ø–∏—Ç—å –≤–æ–¥—É?\n"
                                           f" –ü–∏—Ç—å –≤–æ–¥—É –º–æ–∂–Ω–æ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è. –í–æ–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—á–∏—â–µ–Ω–Ω–∞—è –∏ –Ω–µ –≥–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è.\n"
                                           f" ‚ùì –ö–∞–∫ –≥–æ—Ç–æ–≤–∏—Ç—å –±–µ–∑ —Å–æ–ª–∏? –ï–¥–∞ –±—É–¥–µ—Ç –ø—Ä–µ—Å–Ω–∞!\n"
                                           f" –ú—ã —É–∂–µ –Ω–∞—Å—Ç–æ–ª—å–∫–æ –ø—Ä–∏–≤—ã–∫–ª–∏ –≤—Å–µ —Å–æ–ª–∏—Ç—å, —á—Ç–æ –æ—Ç–≤—ã–∫–ª–∏ –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤–∫—É—Å–∞ –µ–¥—ã. –ü–æ–∫—É–ø–∞–π—Ç–µ —Å–≤–µ–∂–∏–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç—Ä–∞–≤—ã –∏ –ø—Ä–∏–ø—Ä–∞–≤—ã –±–µ–∑ —Å–æ–ª–∏.\n", reply_markup=back_or_main_menu_keyboard)
        await callback.answer()


@router.callback_query(lambda c: c.data == "training_question")
async def send_answer_training(callback: CallbackQuery):
    await callback.message.answer(text=f"‚ÄºÔ∏è–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã:‚ÄºÔ∏è\n"
                                         f"‚ùì –í –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –±—É–¥—É—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏? ‚è∞\n"
                                         f"–ó–∞–ø–∏—Å–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –±—É–¥—É—Ç —Ä–∞–∑–º–µ—â–∞—Ç—å—Å—è –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, —Å—Ä–µ–¥—É –∏ –ø—è—Ç–Ω–∏—Ü—É –≤ 6 —á–∞—Å–æ–≤ —É—Ç—Ä–∞. –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –æ–±—É—Å–ª–æ–≤–ª–µ–Ω —Ç–µ–º, —á—Ç–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤—Å—è –†–æ—Å—Å–∏—è, –∏ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö —Ä–∞–∑–Ω–∏—Ü–∞ —Å –ú–æ—Å–∫–≤–æ–π —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 6, 8 –∏ –¥–∞–∂–µ 12 —á–∞—Å–æ–≤!\n"
                                         f"‚ùì –ö–∞–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏ –º–æ–∂–Ω–æ –ª–∏ –∏—Ö –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤ –¥–æ–º–∞—à–Ω–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö? üè†üßò‚Äç‚ôÄÔ∏è\n"
                                         f"–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤ –ª—é–±–æ–º –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–º –¥–ª—è –≤–∞—Å –º–µ—Å—Ç–µ: –¥–æ–º–∞, –Ω–∞ —É–ª–∏—Ü–µ (—Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞), —Ñ–∏—Ç–Ω–µ—Å –∫–ª—É–±. –ò–∑ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≤—Ä–∏–∫, –±—É—Ç—ã–ª–∫–∞ –≤–æ–¥—ã –∏ —Ö–æ—Ä–æ—à–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ!\n"
                                         f"‚ùì –ï—Å—Ç—å –ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É? üßìüëß\n"
                                         f"–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –Ω–µ—Ç, —Å–∞–º–æ–º—É –≤–∑—Ä–æ—Å–ª–æ–º—É –º–æ–µ–º—É —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—É 74 –≥–æ–¥–∞.\n", reply_markup=training_question_keyboard)
    await callback.answer()

    @router.callback_query(lambda c: c.data == "recomendation_training")
    async def send_recomendation_training(callback: CallbackQuery):
        await callback.message.answer(text=f"‚ÄºÔ∏è–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö:‚ÄºÔ∏è\n"
                                            f"‚ùì –ö–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ? –ï—Å–ª–∏ —É –º–µ–Ω—è —Ç—Ä–∞–≤–º—ã, –º–æ–≥—É –ª–∏ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å? ü§ï\n"
                                            f"–í –ø—Ä–æ–µ–∫—Ç–µ –º–æ–≥—É—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤—Å–µ! –ö–∞–∂–¥–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –±—É–¥–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å —Ä–∞–∑–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏.\n"
                                            f"‚ùì –ù—É–∂–Ω–æ –ª–∏ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ —Ç–µ –¥–Ω–∏, –∫–æ–≥–¥–∞ –Ω–µ—Ç –Ω–æ–≤—ã—Ö? –ò–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ 3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é? üìÖüèãÔ∏è‚Äç‚ôÇÔ∏è\n"
                                            f"–ù–µ—Ç, –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏. –ù–∞–¥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Ç—Ä–∏ —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é, –∫–∞–∫ —É –≤–∞—Å —É–∫–∞–∑–∞–Ω–æ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏.\n"
                                            f"‚ùì –ú–æ–∂–Ω–æ –ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è, –µ—Å–ª–∏ –∑–∞–±–æ–ª–µ–ª? ü§íüí™\n"
                                            f"–¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ –±–æ–ª–µ–∑–Ω–∏ –º–æ–∂–Ω–æ, –Ω–æ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –Ω–µ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —Å–Ω–∏–∂–∞—é—Ç—Å—è –Ω–∞ 20-30%.\n", reply_markup=back_or_main_menu_keyboard)
        await callback.answer()


@router.callback_query(lambda c: c.data == "problem_pay")
async def send_problem_pay(callback: CallbackQuery):
    await callback.message.answer(text=f"–ï—Å–ª–∏ —É –≤–∞—Å –ø–æ—è–≤–∏–ª–∏—Å—å —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å –æ–ø–ª–∞—Ç–æ–π, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º ", reply_markup=pay_problem_keyboard)


@router.callback_query(lambda c: c.data == "training")
async def send_training(callback: CallbackQuery):
    conn = connect()
    cursor = conn.cursor()

    try:
        # –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã users –ø–æ telegram_user_id
        cursor.execute("SELECT id FROM users WHERE telegram_user_id = %s", (callback.from_user.id,))
        user = cursor.fetchone()
        if not user:
            logging.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å telegram_user_id {callback.from_userid} –Ω–µ –Ω–∞–π–¥–µ–Ω.")
            return

        user_id = user[0]

        # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É—á–µ—Ç–æ–º URL –∏–∑ —Ç–∞–±–ª–∏—Ü—ã training_links
        cursor.execute("""
                SELECT ut.training_number, tl.training_url
                FROM user_trainings ut
                JOIN training_links tl ON ut.training_number = tl.training_number
                WHERE ut.user_id = %s AND ut.is_sent = TRUE
                ORDER BY ut.sent_date DESC
                LIMIT 1
            """, (user_id,))

        last_sent_training = cursor.fetchone()
        if not last_sent_training:
            logging.info(f"–ù–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {callback.from_user.id}")
            return

        training_number, training_url = last_sent_training

        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Å—ã–ª–∫—É
        await callback.message.answer(text=f'–í–∞—à–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ (‚Ññ{training_number}): {training_url}')

    except Exception as e:
        logging.error(f"–û—à–∏–±–∫–∞: {e}")
    finally:
        cursor.close()
        close(conn)